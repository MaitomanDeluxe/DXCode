<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DXCode - VSCode-like Editor (Standalone)</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DXCode">

    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">

    <link rel="stylesheet" href="styles.css">

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div id="app-container">
        <div id="menu-bar">
            <div class="menu-item" data-menu="file">ファイル(F)
                <div class="dropdown-menu" id="menu-file">
                    <div class="menu-option" data-action="new-file"><span><i class="fas fa-file"></i> 新しいファイル</span><span class="menu-shortcut">Ctrl+N</span></div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" data-action="save"><span><i class="fas fa-save"></i> 上書き保存</span><span class="menu-shortcut">Ctrl+S</span></div>
                    <div class="menu-option" data-action="download-zip"><span><i class="fas fa-file-archive"></i> 名前を付けて保存 (ZIP)</span></div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" data-action="close-file"><span><i class="fas fa-times-circle"></i> ファイルを閉じる</span></div>
                </div>
            </div>

            <div class="menu-item" data-menu="edit">編集(E)
                <div class="dropdown-menu" id="menu-edit">
                    <div class="menu-option" data-action="undo"><span><i class="fas fa-undo"></i> 元に戻す</span><span class="menu-shortcut">Ctrl+Z</span></div>
                    <div class="menu-option" data-action="redo"><span><i class="fas fa-redo"></i> やり直し</span><span class="menu-shortcut">Ctrl+Y</span></div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" data-action="find"><span><i class="fas fa-search"></i> 検索</span><span class="menu-shortcut">Ctrl+F</span></div>
                </div>
            </div>

            <div class="menu-item" data-menu="view">表示(V)
                <div class="dropdown-menu" id="menu-view">
                    <div class="menu-option" data-action="toggle-sidebar"><span><i class="fas fa-bars"></i> エクスプローラーの表示/非表示</span></div>
                    <div class="menu-option" data-action="toggle-activitybar"><span><i class="fas fa-grip-lines-vertical"></i> アクティビティバーの表示/非表示</span></div>
                </div>
            </div>

            <div class="menu-item" data-menu="run">実行(R)
                <div class="dropdown-menu" id="menu-run">
                    <div class="menu-option" data-action="open-preview"><span><i class="fas fa-play"></i> プレビューの開始 (HTML)</span></div>
                </div>
            </div>

            <div class="menu-item" data-menu="help">ヘルプ(H)
                <div class="dropdown-menu" id="menu-help">
                    <div class="menu-option" data-action="about"><span>DXCode について</span></div>
                </div>
            </div>
        </div>

        <div id="workspace">
            <div id="activity-bar">
                <div class="activity-icon active" data-view="explorer" title="エクスプローラー"><i class="fas fa-file"></i></div>
                <div class="activity-icon" data-view="search" title="検索"><i class="fas fa-search"></i></div>
                <div class="activity-icon" data-view="source-control" title="ソース管理"><i class="fas fa-code-branch"></i></div>
                <div class="activity-icon" data-view="run" title="実行とデバッグ"><i class="fas fa-play-circle"></i></div>
                <div class="activity-icon" data-view="extensions" title="拡張機能"><i class="fas fa-puzzle-piece"></i></div>
            </div>

            <div id="sidebar-container">
                <div id="sidebar-header">エクスプローラー</div>

                <div class="explorer-section">
                    <div id="action-buttons">
                        <button id="new-file-btn" title="新しいファイルを作成 (Ctrl+N)">+ New File</button>
                        <button id="download-zip-btn" title="プロジェクトをZIPとしてダウンロード"><i class="fas fa-file-archive"></i> ZIP Download</button>
                        <button id="preview-btn" title="プレビューを表示 (HTMLファイル選択時のみ)" style="display: none;"><i class="fas fa-play"></i> Run Preview</button>
                    </div>

                    <ul id="file-list"></ul>
                </div>
            </div>

            <div id="editor-area">
                <div id="tab-bar"></div>
                <div id="monaco-editor" style="height:100%;"></div>
            </div>
        </div>

        <div id="status-bar">
            <div class="status-item"><i class="fas fa-code-branch"></i> main*</div>
            <div class="status-item"><i class="fas fa-sync-alt"></i> 同期</div>
            <div style="flex-grow: 1;"></div>
            <div id="status-file-info" class="status-item">UTF-8 CRLF HTML</div>
            <div class="status-item"><i class="fas fa-bell"></i></div>
        </div>
    </div>

    <!-- Inlined main.js (fixed: initial test files + preview virtual console) -->
    <script>
    (function () {
        // --- basics ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.warn('SW reg failed', err));
            });
        }

        let monacoEditor = null;
        const virtualFileSystem = new Map();
        let activeFile = null;
        const DB_NAME = 'DXCodeDB';
        const STORE_NAME = 'VFS';
        let searchDecorations = [];

        function hideAllMenus() {
            document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('visible'));
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        }

        // IndexedDB
        function openDB() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_NAME, 1);
                req.onupgradeneeded = (e) => e.target.result.createObjectStore(STORE_NAME, { keyPath: 'fileName' });
                req.onsuccess = e => resolve(e.target.result);
                req.onerror = e => reject(e.target.error);
            });
        }

        async function saveProject() {
            try {
                const db = await openDB();
                const tx = db.transaction(STORE_NAME, 'readwrite');
                const store = tx.objectStore(STORE_NAME);
                store.clear();
                virtualFileSystem.forEach((model, fileName) => {
                    store.put({ fileName, content: model.getValue() });
                });
                await new Promise(res => tx.oncomplete = res);
                console.log('Saved to IndexedDB');
                alert('保存しました (IndexedDB)');
            } catch (e) {
                console.error(e);
                alert('保存に失敗しました（コンソール参照）');
            }
        }

        async function loadProject() {
            try {
                const db = await openDB();
                const tx = db.transaction(STORE_NAME, 'readonly');
                const store = tx.objectStore(STORE_NAME);
                const req = store.getAll();
                req.onsuccess = () => {
                    if (req.result.length > 0) {
                        req.result.forEach(item => createFile(item.fileName, item.content, false));
                        setActiveFile(virtualFileSystem.keys().next().value);
                    } else {
                        createInitialFiles();
                    }
                };
                req.onerror = () => createInitialFiles();
            } catch (e) {
                createInitialFiles();
            }
        }

        // --- initial files (fixed / clearer) ---
        function createInitialFiles() {
            // index.html: small demo that references style.css and script.js (so preview replacement works)
            const indexHtml = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>DXCode Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Hello DXCode</h1>
  <p id="msg">This is the demo page for DXCode preview.</p>
  <button id="btn">Click me</button>
</body>
</html>
`;
            const styleCss = `body { background: #2e2e2e; color: #eee; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; }
h1 { color: #8fd3ff; }
button { background: #007acc; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }`;

            const scriptJs = `console.log("DXCode demo script running"); 
document.getElementById('btn')?.addEventListener('click', () => {
  console.log('Button clicked!');
  const p = document.getElementById('msg');
  if (p) p.textContent = 'Button was clicked — check virtual console below';
});
// produce various logs to show console types
console.info('Info message');
console.warn('Warning message');
console.error('Error message (example)');`;

            createFile('index.html', indexHtml, true);
            createFile('style.css', styleCss, false);
            createFile('script.js', scriptJs, false);
        }

        // --- VFS / UI ---
        function getLanguage(fileName) {
            const ext = (fileName.split('.').pop() || '').toLowerCase();
            if (ext === 'html') return 'html';
            if (ext === 'css') return 'css';
            if (ext === 'js') return 'javascript';
            if (ext === 'json') return 'json';
            return 'plaintext';
        }

        function createFile(fileName, content = '', activate = true) {
            if (virtualFileSystem.has(fileName)) {
                alert(`${fileName} は既に存在します。`);
                return;
            }
            const model = monaco.editor.createModel(content, getLanguage(fileName));
            virtualFileSystem.set(fileName, model);
            if (activate) setActiveFile(fileName);
            updateUI();
        }

        function setActiveFile(fileName) {
            if (!virtualFileSystem.has(fileName) || fileName === activeFile) return;
            activeFile = fileName;
            const model = virtualFileSystem.get(fileName);
            monacoEditor.setModel(model);
            monaco.editor.setModelLanguage(model, getLanguage(fileName));
            updateUI();
        }

        function updateUI() {
            const fileListEl = document.getElementById('file-list');
            const tabBarEl = document.getElementById('tab-bar');
            const previewBtn = document.getElementById('preview-btn');
            const statusFileInfoEl = document.getElementById('status-file-info');
            fileListEl.innerHTML = '';
            tabBarEl.innerHTML = '';

            const activeFileExt = activeFile ? activeFile.split('.').pop() : '';
            previewBtn.style.display = (activeFileExt === 'html') ? 'block' : 'none';
            statusFileInfoEl.textContent = `${(activeFileExt || 'N/A').toUpperCase()} | UTF-8 | CRLF`;

            virtualFileSystem.forEach((model, fileName) => {
                const isActive = fileName === activeFile;
                const li = document.createElement('li');
                li.textContent = fileName;
                li.className = isActive ? 'active' : '';
                li.onclick = () => setActiveFile(fileName);
                fileListEl.appendChild(li);

                const tab = document.createElement('div');
                tab.textContent = fileName;
                tab.className = 'tab ' + (isActive ? 'active' : '');
                tab.onclick = () => setActiveFile(fileName);
                tabBarEl.appendChild(tab);
            });

            if (!activeFile && virtualFileSystem.size === 0) monacoEditor.setModel(null);
        }

        // --- Preview with virtual console (fixed) ---
        function escapeForHtml(s) {
            if (!s) return '';
            return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/<\/script>/gi, '<\\/script>');
        }

        function openPreview() {
            const codeData = {
                html: virtualFileSystem.get('index.html')?.getValue() || '<h1>index.html not found</h1>',
                css: virtualFileSystem.get('style.css')?.getValue() || '',
                js: virtualFileSystem.get('script.js')?.getValue() || '',
                fileNames: Array.from(virtualFileSystem.keys())
            };

            // Replace style link with inline CSS (if present)
            const htmlWithCss = codeData.html.replace(/<link[^>]*href=["']style\.css["'][^>]*>/i, `<style>${codeData.css}</style>`);

            // Escape user JS for safe embedding inside type="text/plain"
            const userJsEscaped = escapeForHtml(codeData.js);

            const previewContent = `<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>DXCode Preview</title>
<style>
/* virtual console styles */
#dxcode-console-wrapper { position: fixed; bottom: 0; left: 0; right: 0; height: 200px; background: #111; color: #ddd; z-index: 99999; display:flex; flex-direction:column; font-family: monospace; }
#dxcode-console { flex:1; overflow:auto; padding:8px; white-space:pre-wrap; }
#dxcode-prompt { border:none; padding:8px; background:#0f0f0f; color:#fff; outline:none; width:100%; box-sizing:border-box; }
.log-item { margin-bottom:6px; }
.log-error { color:#ff6b6b; }
.log-warn { color:#ffd166; color:#f7c948; }
.log-info { color:#8ab4ff; }
#close-btn { position: fixed; top:10px; right:10px; width:30px; height:30px; border-radius:50%; background:rgba(0,0,0,0.6); color:#fff; border:none; font-size:20px; cursor:pointer; z-index:100000; }
body { margin-bottom:210px; }
</style>
</head>
<body>
${htmlWithCss}
<!-- user script stored as plain text to avoid parser confusion -->
<script id="user-script" type="text/plain">${userJsEscaped}</script>

<script>
// Virtual console implementation inside preview
(function () {
    const consoleWrapper = document.createElement('div');
    consoleWrapper.id = 'dxcode-console-wrapper';
    const consoleEl = document.createElement('div');
    consoleEl.id = 'dxcode-console';
    const promptEl = document.createElement('input');
    promptEl.id = 'dxcode-prompt';
    promptEl.placeholder = 'Enter command (ls, whoami, clear) and press Enter';

    consoleWrapper.appendChild(consoleEl);
    consoleWrapper.appendChild(promptEl);
    document.body.appendChild(consoleWrapper);

    function appendLog(type, args) {
        const item = document.createElement('div');
        item.className = 'log-item ' + (type === 'error' ? 'log-error' : type === 'warn' ? 'log-warn' : type === 'info' ? 'log-info' : '');
        const parts = Array.from(args).map(a => {
            try { return typeof a === 'object' ? JSON.stringify(a) : String(a); } catch(e) { return String(a); }
        });
        item.textContent = '[' + type.toUpperCase() + '] ' + parts.join(' ');
        consoleEl.appendChild(item);
        consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    // capture console
    const originalConsole = window.console;
    ['log','info','warn','error'].forEach(fn => {
        const orig = originalConsole[fn];
        window.console[fn] = function() {
            appendLog(fn, arguments);
            try { orig.apply(originalConsole, arguments); } catch(e) {}
        };
    });

    // simple command runner
    function runCommand(cmd) {
        cmd = (cmd || '').trim();
        if (!cmd) return;
        const parts = cmd.split(/\\s+/);
        const c = parts[0].toLowerCase();
        if (c === 'ls' || c === 'dir') {
            appendLog('info', [${JSON.stringify(codeData.fileNames)}.join('   ')]);
        } else if (c === 'clear') {
            consoleEl.innerHTML = '';
        } else if (c === 'whoami') {
            appendLog('info', [navigator.userAgent]);
        } else {
            appendLog('error', ['Command not found:', c]);
        }
    }

    promptEl.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            runCommand(promptEl.value);
            promptEl.value = '';
        }
    });

    // close button
    const closeBtn = document.createElement('button');
    closeBtn.id = 'close-btn';
    closeBtn.innerHTML = '&times;';
    closeBtn.onclick = () => window.close();
    document.body.appendChild(closeBtn);

    // execute user script safely (try/catch)
    try {
        const userScriptEl = document.getElementById('user-script');
        const code = userScriptEl ? userScriptEl.textContent : '';
        if (code) {
            try {
                // eslint-disable-next-line no-eval
                eval(code);
            } catch (err) {
                appendLog('error', ['Uncaught error in user script:', err && err.message ? err.message : err]);
            }
        } else {
            appendLog('warn', ['No user script found.']);
        }
    } catch (err) {
        appendLog('error', ['Failed to run user script:', err]);
    }
})();
</script>
</body>
</html>`;

            const previewWindow = window.open();
            if (!previewWindow) {
                alert('ポップアップがブロックされました。プレビューを表示できません。');
                return;
            }
            previewWindow.document.write(previewContent);
            previewWindow.document.close();
        }

        // --- ZIP download handler ---
        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'download-zip-btn') {
                if (virtualFileSystem.size === 0) { alert('プロジェクトが空です。'); return; }
                const zip = new JSZip();
                virtualFileSystem.forEach((model, fileName) => zip.file(fileName, model.getValue()));
                zip.generateAsync({ type: 'blob' }).then(content => saveAs(content, 'DXCode_Project.zip')).catch(err => { console.error(err); alert('ZIP生成エラー'); });
            }
        });

        // --- Menu / actions ---
        function setupMenuBar() {
            const menuItems = document.querySelectorAll('#menu-bar .menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', ev => {
                    ev.stopPropagation();
                    const dropdown = item.querySelector('.dropdown-menu');
                    const isActive = dropdown.classList.contains('visible');
                    hideAllMenus();
                    if (!isActive) { dropdown.classList.add('visible'); item.classList.add('active'); }
                });
            });
            document.body.addEventListener('click', hideAllMenus);
            document.querySelectorAll('.dropdown-menu .menu-option').forEach(option => option.addEventListener('click', handleMenuAction));
        }

        function handleMenuAction(e) {
            e.stopPropagation();
            hideAllMenus();
            const action = e.currentTarget.getAttribute('data-action');
            const sidebarContainer = document.getElementById('sidebar-container');
            switch (action) {
                case 'new-file': {
                    const fileName = prompt('新しいファイル名を入力してください (例: example.js):');
                    if (fileName) createFile(fileName.trim(), '', true);
                    break;
                }
                case 'save': saveProject(); break;
                case 'download-zip': document.getElementById('download-zip-btn').click(); break;
                case 'close-file': if (activeFile && virtualFileSystem.has(activeFile)) { virtualFileSystem.get(activeFile).dispose(); virtualFileSystem.delete(activeFile); activeFile = virtualFileSystem.keys().next().value || null; if (activeFile) setActiveFile(activeFile); else monacoEditor.setModel(null); updateUI(); } break;
                case 'undo': monacoEditor.trigger('menu-action','undo',{}); break;
                case 'redo': monacoEditor.trigger('menu-action','redo',{}); break;
                case 'find': monacoEditor.trigger('menu-action','actions.find',{}); break;
                case 'toggle-sidebar': sidebarContainer.style.display = sidebarContainer.style.display === 'none' ? 'flex' : 'none'; break;
                case 'open-preview': if (activeFile && activeFile.endsWith('.html')) openPreview(); else alert('HTML ファイルを選択してください'); break;
                case 'about': alert('DXCode (demo)'); break;
                default: alert('未実装'); break;
            }
        }

        // --- Search panel (lightweight) ---
        function setupSearchPanel() {
            const sidebar = document.getElementById('sidebar-container');
            const explorer = sidebar.querySelector('.explorer-section');
            if (!explorer) return;
            // avoid duplicate panel
            if (document.getElementById('dx-search-panel')) return;

            const panel = document.createElement('div');
            panel.id = 'dx-search-panel';
            panel.style.padding = '8px';
            panel.style.boxSizing = 'border-box';

            const row = document.createElement('div');
            row.style.display = 'flex';
            row.style.gap = '6px';
            row.style.marginBottom = '8px';

            const input = document.createElement('input');
            input.id = 'search-input';
            input.placeholder = '検索語を入力';
            input.style.flex = '1';
            input.addEventListener('keydown', e => { if (e.key === 'Enter') performSearch(input.value); });

            const btn = document.createElement('button');
            btn.textContent = '検索';
            btn.addEventListener('click', () => performSearch(input.value));

            const clear = document.createElement('button');
            clear.textContent = 'クリア';
            clear.addEventListener('click', () => { input.value = ''; renderSearchResults([]); clearSearchDecorations(); });

            row.appendChild(input); row.appendChild(btn); row.appendChild(clear);

            const results = document.createElement('div');
            results.id = 'search-results';
            results.style.height = '240px';
            results.style.overflow = 'auto';
            results.style.fontSize = '13px';
            results.innerHTML = '<div style="padding:8px;color:var(--text-inactive)">Enter query then press Enter / Search.</div>';

            panel.appendChild(row); panel.appendChild(results);
            explorer.appendChild(panel);
        }

        function performSearch(query) {
            const trimmed = (query || '').trim();
            const resultsEl = document.getElementById('search-results');
            if (!resultsEl) return;
            clearSearchDecorations();
            if (!trimmed) { resultsEl.innerHTML = '<div style="padding:8px;color:var(--text-inactive)">検索語を入力してください。</div>'; return; }
            const qLower = trimmed.toLowerCase();
            const hits = [];
            virtualFileSystem.forEach((model, fileName) => {
                const content = model.getValue();
                if (fileName.toLowerCase().includes(qLower)) hits.push({ fileName, line: null, text: '(ファイル名にヒット)', start: 0, length: 0 });
                const lines = content.split(/\r?\n/);
                for (let i = 0; i < lines.length; i++) { const idx = lines[i].toLowerCase().indexOf(qLower); if (idx !== -1) hits.push({ fileName, line: i, text: lines[i], start: idx, length: trimmed.length }); }
            });
            renderSearchResults(hits);
        }

        function renderSearchResults(hits) {
            const resultsEl = document.getElementById('search-results');
            if (!resultsEl) return;
            resultsEl.innerHTML = '';
            if (!hits || hits.length === 0) { resultsEl.innerHTML = '<div style="padding:8px;color:var(--text-inactive)">該当する結果はありません。</div>'; return; }
            hits.forEach(hit => {
                const item = document.createElement('div');
                item.style.padding = '8px';
                item.style.borderBottom = '1px solid rgba(255,255,255,0.03)';
                const fileEl = document.createElement('div'); fileEl.textContent = hit.fileName + (hit.line !== null ? ` : ${hit.line + 1}` : ''); fileEl.style.fontWeight = '600';
                item.appendChild(fileEl);
                if (hit.line !== null) { const lineEl = document.createElement('div'); lineEl.textContent = hit.text.trim(); lineEl.style.color = 'var(--text-inactive)'; item.appendChild(lineEl); }
                item.addEventListener('click', () => { setActiveFile(hit.fileName); if (hit.line !== null) { const model = virtualFileSystem.get(hit.fileName); if (!model) return; monacoEditor.setModel(model); const startLineNumber = hit.line + 1; const startColumn = hit.start + 1; const endColumn = hit.start + hit.length + 1; const range = new monaco.Range(startLineNumber, startColumn, startLineNumber, endColumn); searchDecorations = monacoEditor.deltaDecorations(searchDecorations, [{ range, options: { inlineClassName: 'dx-search-decor' } }]); monacoEditor.revealRangeInCenter(range); monacoEditor.setSelection(range); monacoEditor.focus(); } else { const model = virtualFileSystem.get(hit.fileName); if (model) monacoEditor.setModel(model); } });
                resultsEl.appendChild(item);
            });
        }

        function clearSearchDecorations() { if (!monacoEditor) return; searchDecorations = monacoEditor.deltaDecorations(searchDecorations, []); }

        // --- Monaco init ---
        require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' }});
        require(['vs/editor/editor.main'], function () {
            monacoEditor = monaco.editor.create(document.getElementById('monaco-editor'), { language: 'plaintext', theme: 'vs-dark', automaticLayout: true, minimap: { enabled: true }, fontFamily: 'Menlo, Monaco, "Courier New", monospace', fontSize: 13 });
            loadProject();
            document.getElementById('new-file-btn').addEventListener('click', () => { const fn = prompt('新しいファイル名:'); if (fn) createFile(fn.trim(), '', true); });
            document.getElementById('preview-btn').addEventListener('click', openPreview);
            monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => { saveProject(); return null; }, 'EditorTextFocus');
            monacoEditor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyN, () => { document.getElementById('new-file-btn').click(); });
            setupMenuBar();
            setupSearchPanel();

            // Activity icons simple behavior
            const activityIcons = document.querySelectorAll('.activity-icon');
            const sidebarContainer = document.getElementById('sidebar-container');
            let isSidebarVisible = true;
            activityIcons.forEach(icon => icon.addEventListener('click', () => {
                activityIcons.forEach(i => i.classList.remove('active'));
                icon.classList.add('active');
                const view = icon.getAttribute('data-view');
                if (view === 'explorer') {
                    isSidebarVisible = !isSidebarVisible;
                    if (!isSidebarVisible) icon.classList.remove('active');
                    sidebarContainer.style.display = isSidebarVisible ? 'flex' : 'none';
                } else if (view === 'search') {
                    sidebarContainer.style.display = 'flex';
                    isSidebarVisible = true;
                } else {
                    sidebarContainer.style.display = 'flex';
                    isSidebarVisible = true;
                    alert('このビューはダミーです。');
                }
            }));
        });
    })();
    </script>
</body>
</html>
